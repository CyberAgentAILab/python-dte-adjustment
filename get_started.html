<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Get Started &#8212; dte_adj 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Modules" href="modules.html" />
    <link rel="prev" title="Installation Guide" href="installation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="get-started">
<h1>Get Started<a class="headerlink" href="#get-started" title="Link to this heading">¶</a></h1>
<p>This page contains basic usage of dte_adj library.</p>
<p>Generate data for training cumulative distribution function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">generate_data</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d_x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate data according to the described data generating process (DGP).</span>

<span class="sd">    Args:</span>
<span class="sd">    n (int): Number of samples.</span>
<span class="sd">    d_x (int): Number of covariates. Default is 100.</span>
<span class="sd">    rho (float): Success probability for the Bernoulli distribution. Default is 0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">    X (np.ndarray): Covariates matrix of shape (n, d_x).</span>
<span class="sd">    D (np.ndarray): Treatment variable array of shape (n,).</span>
<span class="sd">    Y (np.ndarray): Outcome variable array of shape (n,).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate covariates X from a uniform distribution on (0, 1)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d_x</span><span class="p">))</span>

    <span class="c1"># Generate treatment variable D from a Bernoulli distribution with success probability rho</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="c1"># Define beta_j and gamma_j according to the problem statement</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">d_x</span><span class="p">)</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">d_x</span><span class="p">)</span>

    <span class="c1"># Set the first 50 values of beta and gamma to 1</span>
    <span class="n">beta</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">gamma</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Compute the outcome Y</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Error term</span>
    <span class="n">linear_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">quadratic_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>

    <span class="c1"># Outcome equation</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">D</span> <span class="o">+</span> <span class="n">linear_term</span> <span class="o">+</span> <span class="n">quadratic_term</span> <span class="o">+</span> <span class="n">U</span>

    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">Y</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Sample size</span>
<span class="n">X</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">generate_data</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, let’s build an empirical cumulative distribution function (CDF).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dte_adj</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">dte_adj</span><span class="o">.</span><span class="n">SimpleDistributionEstimator</span><span class="p">()</span>
<span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">cdf</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>Distributional treatment effect (DTE) can be computed easily in the following code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">dte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict_dte</span><span class="p">(</span><span class="n">target_treatment_arm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">control_treatment_arm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="n">locations</span><span class="p">,</span> <span class="n">variance_type</span><span class="o">=</span><span class="s2">&quot;simple&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A convenience function is available to visualize distribution effects. This method can be used for other distribution parameters including Probability Treatment Effect (PTE) and Quantile Treatment Effect (QTE).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">dte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;DTE of simple estimator&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/dte_empirical.png"><img alt="DTE of empirical estimator" class="align-center" src="_images/dte_empirical.png" style="width: 450px; height: 300px;" />
</a>
<p>To initialize the adjusted distribution function, the base model for conditional distribution function needs to be passed.
In the following example, we use Logistic Regression. Please make sure that your base model implements <cite>fit</cite> and <cite>predict_proba</cite> methods.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="n">logit</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">dte_adj</span><span class="o">.</span><span class="n">AdjustedDistributionEstimator</span><span class="p">(</span><span class="n">logit</span><span class="p">,</span> <span class="n">folds</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">cdf</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>DTE can be computed and visualized in the following code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict_dte</span><span class="p">(</span><span class="n">target_treatment_arm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">control_treatment_arm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="n">locations</span><span class="p">,</span> <span class="n">variance_type</span><span class="o">=</span><span class="s2">&quot;simple&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">dte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;DTE of adjusted estimator with simple confidence band&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/dte_simple.png"><img alt="DTE of adjusted estimator with simple confidence band" class="align-center" src="_images/dte_simple.png" style="width: 450px; height: 300px;" />
</a>
<p>Confidence bands can be computed in different ways. In the following code, we use moment method to calculate the confidence band.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict_dte</span><span class="p">(</span><span class="n">target_treatment_arm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">control_treatment_arm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="n">locations</span><span class="p">,</span> <span class="n">variance_type</span><span class="o">=</span><span class="s2">&quot;moment&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">dte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;DTE of adjusted estimator with moment confidence band&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/dte_moment.png"><img alt="DTE of adjusted estimator with moment confidence band" class="align-center" src="_images/dte_moment.png" style="width: 450px; height: 300px;" />
</a>
<p>Also, an uniform confidence band is used when “uniform” is specified for the “variance_type” argument.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict_dte</span><span class="p">(</span><span class="n">target_treatment_arm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">control_treatment_arm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="n">locations</span><span class="p">,</span> <span class="n">variance_type</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">dte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;DTE of adjusted estimator with uniform confidence band&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/dte_uniform.png"><img alt="DTE of adjusted estimator with uniform confidence band" class="align-center" src="_images/dte_uniform.png" style="width: 450px; height: 300px;" />
</a>
<p>To compute PTE, we can use “predict_pte” method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict_pte</span><span class="p">(</span><span class="n">target_treatment_arm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">control_treatment_arm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="n">locations</span><span class="p">,</span> <span class="n">variance_type</span><span class="o">=</span><span class="s2">&quot;simple&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">pte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;PTE of adjusted estimator with simple confidence band&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/pte_simple.png"><img alt="PTE of adjusted estimator with simple confidence band" class="align-center" src="_images/pte_simple.png" style="width: 450px; height: 300px;" />
</a>
<p>To compute QTE, we use “predict_qte” method. The confidence band is computed by bootstrap method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">qte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict_qte</span><span class="p">(</span><span class="n">target_treatment_arm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">control_treatment_arm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">quantiles</span><span class="o">=</span><span class="n">quantiles</span><span class="p">,</span> <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">quantiles</span><span class="p">,</span> <span class="n">qte</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;QTE of adjusted estimator&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/qte.png"><img alt="QTE of adjusted estimator" class="align-center" src="_images/qte.png" style="width: 450px; height: 300px;" />
</a>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">dte_adj</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contribution Guide</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="previous chapter">Installation Guide</a></li>
      <li>Next: <a href="modules.html" title="next chapter">Modules</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, CyberAgent, Inc..
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/get_started.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>